name: CI

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  build-x64:
    runs-on: ubuntu-latest
    name: Build x64
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Make build script executable
      run: chmod +x build.sh
    
    - name: Run build script
      run: ./build.sh

  build-arm64:
    runs-on: ubuntu-latest
    name: Build ARM64
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup ARM64 cross-compilation environment
      run: |
        # Add arm64 architecture
        sudo dpkg --add-architecture arm64
        
        # Create a proper sources.list for ARM64 packages using ports.ubuntu.com
        sudo tee /etc/apt/sources.list.d/arm64.list > /dev/null <<EOF
        deb [arch=arm64] http://ports.ubuntu.com/ubuntu-ports noble main restricted universe multiverse
        deb [arch=arm64] http://ports.ubuntu.com/ubuntu-ports noble-updates main restricted universe multiverse
        deb [arch=arm64] http://ports.ubuntu.com/ubuntu-ports noble-backports main restricted universe multiverse
        deb [arch=arm64] http://ports.ubuntu.com/ubuntu-ports noble-security main restricted universe multiverse
        EOF
        
        # Update package lists
        sudo apt-get update
        
        # Install cross-compilation tools
        sudo apt-get install -y \
          crossbuild-essential-arm64 \
          g++-aarch64-linux-gnu \
          gcc-aarch64-linux-gnu
    
    - name: Make build script executable
      run: chmod +x build-arm64.sh
    
    - name: Run ARM64 build script
      run: ./build-arm64.sh